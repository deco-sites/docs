---
description: TODO
since: 1.0.0
---

## Enviando eventos para o dataLayer

O `dataLayer` é a camada de dados utilizada pelo Google Tag Manager ou Google
Tag (utilizado pelo Google Analytics) para gerenciar os eventos dos pixels que
estão configurados na tag.

No template da deco.cx, existe o hook
[useSendEvent](https://github.com/deco-sites/storefront/blob/main/sdk/useSendEvent.ts)
que aceita como parâmetro o objeto da interface Options, que nele possui a propriedade
[AnalyticsEvent](https://github.com/deco-cx/apps/blob/3e337b6b2996d7ecd72db34174896638c92f8811/commerce/types.ts#L754)
e retorna os atributos necessários para disparar o evento no dataLayer.
Esse hook facilita o envio de eventos de view, click e change diretamente nos elementos, sem precisar criar componentes específicos.

Exemplos:

1. Enviando evento de `add_to_cart` quando o usuário clicar no botão de
   adicionar produto ao Carrinho. Este componente deve ser utilizado dentro de
   uma Island.

```tsx
import { useSendEvent } from "$store/sdk/analytics.tsx";

interface Props {
  name: string;
  sku: string;
  id: string;
  price: number;
  discount?: number;
  currency: string;
}

function AddToCart({ name, sku, id, price, discount, currency }: Props) {
  const addToCartEvent = useSendEvent({
    on: "click",
    event: {
      name: "add_to_cart",
      params: {
        currency,
        value: price,
        items: [
          {
            item_id: id,
            quantity: 1,
            price: price + (discount ?? 0),
            discount,
            name,
          },
        ],
      },
    },
  });

  const handleClick = () => {
    addSkuToCart({ sku, quantity: 1 });
  };

  return (
    <button {...addToCartEvent} onClick={handleClick}>
      Add to cart
    </button>
  );
}
```

2. Enviando evento de `view_item` na página de produto ao carregar a página

```tsx
import type { Product } from "apps/commerce/types.ts";
import { mapProductToAnalyticsItem } from "apps/commerce/utils/productToAnalyticsItem.ts";
import { useSendEvent } from "$store/sdk/analytics.tsx";
import { useOffer } from "$store/sdk/useOffer.ts";

interface Props {
  product: Product;
  currency: string;
}

function ProductDetails({ product, currency }: Props) {
  const { price, listPrice } = useOffer(product.offers);
  const item = mapProductToAnalyticsItem({ product, price, listPrice });

  const viewItemEvent = useSendEvent({
    on: "view",
    event: {
      name: "view_item",
      params: {
        currency,
        value: price,
        items: [item],
      },
    },
  });

  return (
    <div {...viewItemEvent}>
      <ProductInfo product={product} />
    </div>
  );
}
```

3. Enviando evento de `select_item` ao clicar num link de produto.

```tsx
import type { Product } from "apps/commerce/types.ts";
import { mapProductToAnalyticsItem } from "apps/commerce/utils/productToAnalyticsItem.ts";
import { useSendEvent } from "$store/sdk/analytics.tsx";
import { useOffer } from "$store/sdk/useOffer.ts";

interface Props {
  product: Product;
  itemListId?: string;
  itemListName?: string;
}

function ProductCard({ product, itemListName, itemListId }: Props) {
  const { price, listPrice } = useOffer(product.offers);
  const item = mapProductToAnalyticsItem({ product, price, listPrice });

  const selectItemEvent = useSendEvent({
    on: "click",
    event: {
      name: "select_item",
      params: {
        item_list_name: itemListName,
        item_list_id: itemListId,
        items: [item],
      },
    },
  });

  return (
    <a id={product.productID} href={product.url} {...selectItemEvent}>
      <img src={product.images[0]} alt={product.name} />
      <span>{product.name}</span>
    </a>
  );
}
```

## Customizando função de sendEvents

É possível a criação de uma nova função `sendEventCustom` para disparar eventos para outras
camadas de dados diferente do `dataLayer`. No arquivo `sdk/analytics.tsx` do seu
projeto deco, você pode customizar uma nova função adicionando novas
integrações.

Exemplo:

```diff
import { AnalyticsEvent } from "apps/commerce/types.ts";

export interface Options<E extends AnalyticsEvent> {
  event: E;
  on: "click" | "view" | "change";
}

export const useSendEvent = <E extends AnalyticsEvent>(
  { event, on }: Options<E>,
) => ({
  "data-event": encodeURIComponent(JSON.stringify(event)),
  "data-event-trigger": on,
});

export const sendEventCustom = <E extends AnalyticsEvent>(event: E) => {
  if (typeof window.DECO_SITES_STD?.sendAnalyticsEvent !== "function") {
    console.info(
      "Cannot find Analytics section in your page. Press `.` to add Analytics and supress this warning",
    );

    return;
  }

  if (!window.gtag) {
   window.gtag = function () {
   window.dataLayer.push(arguments);
   };
  }

  window.DECO_SITES_STD.sendAnalyticsEvent(event);
  window.gtag("event", event.name, event.params)
};
```

## Integrando dado do carrinho com o tipo AnalyticsItem

Para integrar um novo modelo de dados de carrinho, adicione um mapeador de dados
no hook de `useCart.ts` da plataforma que está implementando. Exemplo do
[VTEX useCart](https://github.com/deco-cx/apps/blob/3e337b6b2996d7ecd72db34174896638c92f8811/vtex/hooks/useCart.ts#L1).
